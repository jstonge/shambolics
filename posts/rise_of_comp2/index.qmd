---
title: "The rise of computational works 2"
description: |
  A new hope.
categories:
  - Visualization
  - NLP
  - S2ORC
  - Interactive
  - SciSci
date: today
author: Jonathan St-Onge
editor: visual
format: 
    html:
        echo: false 
image: embeddings.png 
---

::: {.callout-warning}
It takes some time for everything to load. Be patien.
:::


#### TODO
 - see [project](https://github.com/users/jstonge/projects/8)

### Specter embeddings of computational papers (early)

```{ojs}
viewof type_cat = Inputs.select(['topic', 'field', 'year', 'selected'], {value: 'field', label: "cluster type"})

viewof sel_field = Inputs.select([''].concat(fields), {value: '', label: "choose field"})

viewof input_title = html`<input placeholder="Title.">`

viewof c = rangeSlider(background_data, d => d.year)

viewof t = rangeSlider(background_data, d => d.topic)

viewof toggle = Inputs.toggle({label: "show paper ids"})

```

There are ${paperIds_data.length} paper from paperIds.

::: {.column-screen-inset}
```{ojs}
embedding_plot = {
  
  const background_mark = (is_colored) => {  
            return { x: "x", y: "y", fill: is_colored ? type_cat : "grey",  opacity: 0.2, r: "citationCount" }
        }
  
  const subset_mark = {
          x: "x", y: "y", fill: type_cat, r: "citationCount", 
          opacity: subset === undefined ? 0.3 : 1, 
          title: d => `${d.title} (${d.field})\n# citations: ${d.citationCount}\nYear: ${d.year}\ntopic: ${d.topic}`
    }

  const field_mark = {
          x: "x", y: "y", opacity: 0.3, r: "citationCount",
          fill: type_cat === 'field' ? 'red' : type_cat,
          title: d => `${d.title} (${d.field})\n# citations: ${d.citationCount}\nYear: ${d.year}\ntopic: ${d.topic}`
        }
  
  const year_mark = {
          x: "x", y: "y", opacity: 0.8, r: "citationCount", 
          fill: type_cat, 
          title: d => `${d.title} (${d.field})\n# citations: ${d.citationCount}\nYear: ${d.year}\ntopic: ${d.topic}`
        }
  
  const paperIds_mark = {
          x: "x", y: "y", opacity: 1, r: "citationCount", fill: 'lab',
          title: d => `${d.title} (${d.field})\n# citations: ${d.citationCount}\nYear: ${d.year}\ntopic: ${d.topic}\nlab: ${d.lab}`
        }

  const background_plot = () => Plot.plot({
      inset: 8, height: 800, width: 1200,
      y: { label: "", ticks: null },
      x: { label: "", ticks: null },
      r: { range: [1.5, 10] },
      color: { type: "categorical", scheme: "paired" },
      marks: [  Plot.dot(background_data,  background_mark(true)  ) ]
    })
  
  const subset_plot = () => Plot.plot({
      inset: 8, height: 800,  width: 1200,
      y: { label: "", ticks: null },
      x: { label: "", ticks: null },
      r: { range: [1.5, 10] },
      color: { type: "categorical", scheme: "paired" },
      marks: [
        Plot.dot(background_data,  background_mark(false)  ),
        Plot.dot(subset, subset_mark )
        ]
    })
  
  const field_plot = () => Plot.plot({
      inset: 8, height: 800, width: 1200,
      y: { label: "", ticks: null },
      x: { label: "", ticks: null },
      r: { range: [1.5, 10] },
      color: { type: "categorical", scheme: "paired" },
      marks: [
        Plot.dot(background_data,  background_mark(false)  ),
        Plot.dot(data_by_field, field_mark )
        ]
    })
  
  const year_plot = () => Plot.plot({
      inset: 8, height: 800, width: 1200,
      y: { label: "", ticks: null },
      x: { label: "", ticks: null },
      r: { range: [1.5, 10] },
      marks: [
        Plot.dot(background_data,  background_mark(false)  ),
        Plot.dot(yearly_data, year_mark  )
        ]
    })  

  const paperIds_plot = () => Plot.plot({
      inset: 8, height: 800, width: 1200,
      y: { label: "", ticks: null },
      x: { label: "", ticks: null },
      r: { range: [1.5, 10] },
      marks: [
        Plot.dot(background_data,  background_mark(false)  ),
        Plot.dot(paperIds_data, paperIds_mark)
        ]
    })  

  const subset_and_field_plot = () => Plot.plot({
      inset: 8, height: 800, width: 1200,
      y: { label: "", ticks: null },
      x: { label: "", ticks: null },
      r: { range: [1.5, 10] },
      color: { type: "categorical", scheme: "paired" },
      marks: [
        Plot.dot(background_data,  background_mark(false)  ),
        Plot.dot(data_by_field, field_mark),
        Plot.dot(subset, subset_mark)
        ]
    })

  if (subset === undefined && sel_field[0] === undefined) {
    if (toggle) {
      return paperIds_plot()
    }
    return year_plot()
  } else if (subset !== undefined && sel_field[0] === undefined) {
    return subset_plot()
  } else if (subset === undefined && sel_field[0] !== undefined) {
    return field_plot()
  } else if (subset === undefined && sel_field[0] === undefined && type_cat === 'selected') {
    return paperIds_plot()
  } else {
    return subset_and_field_plot()
  }
  

}

type_cat === 'selected' ? svg`` : embedding_plot.legend("color")
```
:::

Note that the topics here are custers of documents that are similar with respect to title, abstract, and citations. This is different from vanilla topics that cluster together exclusively based on content.

By adding document-level relatedness, we hope that we will be able to distinguish different facets of how the idea of `computational` is used in the literature. For instance, say that in philosophy there is much discussion about the `computational theory of the mind`. Philosophers won't be citing the same papers than computational papers in political science that cite, say, some methodological papers on how best to construct embeddings in their field. If we are right, then conceptual papers should be fairly easy to distinguish and remove. 

#### table
```{ojs}
Inputs.table(subset === undefined ? yearly_data : subset, {columns: ['topic', 'field', 'year', 'venue', 'citationCount', 'title']})
```


```{ojs}
db = DuckDBClient.of({ 
	data: await FileAttachment("umap_embedding_2NCOMP.csv").csv({typed:true}),
  classifyComp: await FileAttachment("classify-comp-proj-tidy.csv").csv({typed:true})
})

background_data = db.sql`
  SELECT * 
  FROM data  
  USING SAMPLE 10000
`

data_by_field = db.sql`
  SELECT * 
  FROM data 
  WHERE (citationCount > 0 AND field = ${sel_field} AND year >= ${c.range[0]} AND year <= ${c.range[1]} AND topic >= ${t.range[0]} AND topic <= ${t.range[1]})
`

yearly_data = db.sql`
  SELECT * 
  FROM data 
  WHERE (year >= ${c.range[0]} AND year <= ${c.range[1]} AND topic >= ${t.range[0]} AND topic <= ${t.range[1]})
  USING SAMPLE 10000
`

paperIds_data = db.query(
    `SELECT * 
     FROM data 
     INNER JOIN classifyComp ON data.paperId = classifyComp.paper_id;
`)

table_data = db.sql`
  SELECT year, topic, COUNT()::INT as n
  FROM data 
  WHERE (year >= ${c.range[0]} AND year <= ${c.range[1]} AND topic >= ${t.range[0]} AND topic <= ${t.range[1]})
  GROUP BY
    year, topic
`
```


```{ojs}
title_search = debounce(viewof input_title)

subset = {
  let s = Inputs.select([{title: 'Type above more than 2 letters...', eft: 0}], 
                         {format: d => d.title, labedatal: "Titles found"}) 
  if (title_search.length > 2) {
    
    return await db.query(`SELECT * FROM data 
                 WHERE ( contains(lower(title), lower('${title_search}')) AND citationCount > 0 AND year >= ${c.range[0]} AND year <= ${c.range[1]} AND topic >= ${t.range[0]} AND topic <= ${t.range[1]})`)
  } 
}
```


#### Limitations

 - The background data is a sample of 20K documents (out of 156K).
 - When searching a title, we look at all the data (not the 20K subset)
 - We overlay filtered data on top of the background data, which is also a subset of 20K.

#### "Degrees of freedom"
 - With `hdbscan`, we can reduce the number of topics so that we have coarser grain topics.
 - With `umap`, we can choose the number of dimensions to reduce


```{ojs}
import {Plot} from "@mkfreeman/plot-tooltip"
import {debounce} from "@mbostock/debouncing-input"
import {rangeSlider} from "@bumbeishvili/utils"
```

```{ojs}
fields = ['Art', 'Biology', 'Business', 'Chemistry', 'Computer-Science', 'Education', 'Economics', 'Environmental-Science', 'Geography', 'Geology', 'History', 'Law', 'Linguistics', 'Mathematics', 'Philosophy', 'Physics', 'Political-Science', 'Psychology', 'Sociology', ]
```
